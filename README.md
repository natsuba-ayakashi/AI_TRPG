# AI TRPG Bot

これは、Discord上でAIゲームマスターと共にTRPG（テーブルトークRPG）をプレイするためのBotです。

## 主な機能

- **AIゲームマスター**: あなたの行動に応じて、物語をリアルタイムで生成します。
- **動的難易度調整**: ゲームの進行度に応じて、AIが自動で難易度を調整します。手動での設定も可能です。
- **キャラクター管理**: 複数のキャラクターを作成・保存し、好きなキャラクターで冒険を再開できます。
- **キャラクターカスタマイズ**: 自分で描いたイラストなどをキャラクター画像として設定できます。
- **ダイスロール判定**: 行動の成否が不確かな場面では、AIが技能判定を要求し、ダイスロールで結果が決まります。
- **BGM再生機能**: ゲームの状況（戦闘、探索、イベントなど）に応じて、適切なBGMを自動で再生します。
- **アイテム売買**: シナリオ中に登場する店で、アイテムを購入したり、手持ちのアイテムを売却したりできます。
- **実績システム**: ゲーム中の特定の行動に応じて「実績」が解除されます。

## コマンド一覧

### ゲーム進行
- `/start`: 新しい冒険を開始、または中断した冒険を再開します。
- `/quit`: 現在のゲームセッションを中断します（進行状況は保存されません）。
- `/save`: 現在のゲームの進行状況を保存します。
- `/use_item`: インベントリ内のアイテムを使用します。

### キャラクター関連
- `/create`: 対話形式であなただけのキャラクターを作成します。
- `/start_random`: AIが生成したランダムなキャラクターで冒険を開始します。
- `/delete_character`: 保存されているキャラクターデータを削除します。
- `/set_image`: キャラクターのカスタム画像を設定します。
- `/achievements`: 現在のキャラクターの実績達成状況を表示します。

### BGM関連
- `/join`: Botをあなたのいるボイスチャンネルに参加させます。
- `/leave`: Botをボイスチャンネルから退出させます。
- `/play_bgm`: 指定したBGMを再生します。
- `/pause`: BGMを一時停止します。
- `/resume`: 一時停止中のBGMを再生します。
- `/stop`: BGMの再生を停止し、ボイスチャンネルから退出します。
- `/volume`: BGMの音量を調整します（0-200%）。
- `/nowplaying`: 現在再生中のBGM情報を表示します。

### 設定
- `/set_difficulty`: ゲームの難易度を手動で設定します。
- `/reset_difficulty`: ゲームの難易度を自動調整に戻します。

## セットアップ方法

1.  `.env` ファイルを作成し、以下の情報を記述します。
    ```
    DISCORD_BOT_TOKEN=YOUR_DISCORD_BOT_TOKEN
    GOOGLE_CLOUD_PROJECT_ID=YOUR_GOOGLE_CLOUD_PROJECT_ID # 画像生成機能に必要
    GEMINI_API_KEY=YOUR_GEMINI_API_KEY # AIのAPIキー
    CHAR_SHEET_CHANNEL_ID=YOUR_CHANNEL_ID # キャラクターシート更新ログ用
    SCENARIO_LOG_CHANNEL_ID=YOUR_CHANNEL_ID # ゲームクリア/オーバーログ用
    PLAY_LOG_CHANNEL_ID=YOUR_CHANNEL_ID # プレイログ用
    ```
2.  `pip install -r requirements.txt` のような形で必要なライブラリをインストールします。
3.  BGM機能を使用するには、追加で `PyNaCl` をインストールする必要があります (`pip install PyNaCl`)。
4.  また、音声のエンコード・デコードのために FFmpeg をインストールし、システムのパスを通す必要があります。
5.  `python bot.py` でボットを実行します。

## 今後の展望

- **データベース移行**: 現在のJSONファイルベースのセーブシステムを、SQLiteなどのデータベースに移行し、データの管理をより堅牢にする。
- **より高度なUI**: 選択肢やインベントリ管理に、より洗練されたUIコンポーネントを導入する。