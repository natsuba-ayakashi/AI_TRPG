# AI TRPG Fantasy

Discord上でAIゲームマスターと共に遊ぶ、テキストベースのTRPGボットです。
プレイヤーの行動によって世界がダイナミックに変化し、他のプレイヤーの冒険の痕跡があなたの物語に影響を与える、”生きている世界”を目指しています。

## ✨ 主な機能

### 冒険の準備
- **キャラクター作成 (`/character_create`)**:
  - 名前、種族、クラス、プロフィール（外見・背景）、能力値（ダイスロール）を対話形式で設定し、あなただけのキャラクターを作成できます。
- **キャラクター管理**:
  - `/status`: キャラクターシート（能力値、HP/MP、スキル、所持品など）を確認できます。
  - `/levelup`: 冒険で得た経験値（XP）を使い、能力値や技能を強化できます。
  - `/delete_character`: キャラクターを削除します。

### ゲームの進行
- **ゲームの開始と終了**:
  - `/start_game`: 作成したキャラクターを選び、あなた専用のプライベートスレッドで新しい冒険を開始します。
  - `/end_game`: 冒険を中断し、キャラクターの成長や世界の変更点をすべて保存してゲームを終了します。
- **AIによる物語生成 (`/next`)**:
  - 「村人に話しかける」「洞窟を探索する」など、あなたの行動を自由に入力すると、AIがゲームマスターとして物語の続きや行動の結果を生成します。
- **ターン制の戦闘システム**:
  - 物語の展開に応じてシームレスに戦闘が開始されます。
  - プレイヤーのターンと敵のターンが交互に進行します。
  - `/next` で攻撃対象や方法を指示することで、敵にダメージを与えられます。
- **特殊なアクション**:
  - `/use`: インベントリ内のアイテム（例：ポーション）を使用し、HPの回復などの効果を得られます。
  - `/next 逃げる`: 戦闘中に「逃げる」と入力することで、戦闘からの離脱を試みることができます。

### "生きている世界"を体験する機能
- **共有される世界状態**:
  - あなたの行動によって変化したNPCの友好度などの状態は、サーバー全体で共有され、他のプレイヤーのゲームにも影響を与えます。
- **永続的な墓場システム**:
  - 冒険の途中で力尽きたキャラクターは、その世界の「墓場」に記録されます。
  - `/graveyard`: この世界で散っていった過去の冒険者たちの記録（名前、レベル、死因）を閲覧できます。
  - `/search_grave`: 他のプレイヤーが遺した墓を探索し、そのキャラクターが持っていたアイテムを回収できることがあります。

### 補助機能
- **ゲームログ**:
  - ゲームの開始、進行（プレイヤーの行動とAIの応答）、終了といったすべてのイベントが、指定されたログチャンネルに記録されます。
- **ユーティリティ**:
  - `/help`: 利用可能なコマンドの一覧を表示します。
  - `/ping`: Botの応答速度を確認します。

## 📂 プロジェクト構成

```
AI_TRPG_Fantasy/
├── bot/              # Discordボット関連
│   ├── cogs/         # スラッシュコマンドを機能ごとに分割
│   └── ui/           # EmbedやViewなどのUIコンポーネント
├── game/             # ゲームのコアロジック（Discordに非依存）
│   ├── models/       # Character, Enemy, Sessionなどのデータ構造
│   ├── services/     # ゲームのビジネスロジック
│   └── managers/     # 複数のオブジェクトを管理
├── infrastructure/   # データ保存や外部APIなど技術的な詳細
│   ├── data_loaders/ # 静的データ（世界設定など）の読み込み
│   └── repositories/ # 動的データ（キャラクター、世界状態）の永続化
├── core/             # プロジェクト共通の要素（カスタム例外など）
├── config/           # 設定ファイル
├── game_data/        # ゲームの静的データ（JSONファイル）
└── main.py           # アプリケーションのエントリーポイント
```

## 🚀 セットアップ

1.  **リポジトリをクローンします。**
2.  **必要なライブラリをインストールします。**
    ターミナルで以下のコマンドを実行してください。
    ```bash
    pip install discord.py python-dotenv aiofiles google-generativeai
    ```
3.  **.env.template** をコピーして **.env** ファイルを作成します。
4.  **.env** ファイル内に、Discord Botのトークンや各種チャンネルID、AIのAPIキーなどを設定します。
    `AI_API_KEY` には、Google AI Studioで取得したAPIキーを設定してください。
    ```env
    DISCORD_BOT_TOKEN="YOUR_DISCORD_BOT_TOKEN"
    CHAR_SHEET_CHANNEL_ID="YOUR_CHANNEL_ID"
    SCENARIO_LOG_CHANNEL_ID="YOUR_CHANNEL_ID"
    PLAY_LOG_CHANNEL_ID="YOUR_CHANNEL_ID"
    AI_API_KEY="YOUR_AI_API_KEY"
    AI_MODEL_NAME="gemini-1.5-flash-latest"
    ```
5.  **Botを起動します。**
    ```bash
    python main.py
    ```

---

この`README.md`は、プロジェクトの現状を反映したものです。新しい機能が追加された際には、随時更新していくことが推奨されます。